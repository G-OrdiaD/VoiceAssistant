#:kivy 2.3.1
#:import dp kivy.metrics.dp

<BasePopup>:
    # Keep only properties, no widget structure
    separator_color: 0.3, 0.3, 0.4, 1
    title_align: 'center'
    title_size: dp(20)
    title_color: 1, 1, 1, 1
    size_hint: (0.8, 0.5)
    background: ''
    background_color: 0, 0, 0, 0
    
    # Styling properties for inheritance
    text_color: 1, 1, 1, 1
    label_font_size: dp(20)
    button_font_size: dp(20)
    input_background: 0.2, 0.2, 0.25, 1
    input_text_color: 1, 1, 1, 1
    input_border_color: 0.7, 0.7, 0.7, 1
    cancel_button_color: 0.9, 0.3, 0.3, 1
    save_button_color: 0.36, 0.52, 0.96, 1
    container_padding: [dp(20), dp(15), dp(20), dp(15)]
    container_spacing: dp(15)

<AddTaskPopup>:
    title: 'Add Task'

    canvas.before:
        Color:
            rgba: 0.5, 0.5, 0.55, 1  # Light grey background
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(20),]
        Color:
            rgba: 0.95, 0.93, 0.85, 1  # Cream border color
        Line:
            width: dp(0.5)
            rounded_rectangle: [self.x, self.y, self.width, self.height, dp(20)]

    BoxLayout:
        orientation: 'vertical'
        padding: root.container_padding
        spacing: root.container_spacing

        Label:
            text: 'Enter your task:'
            font_size: root.label_font_size
            font_name: root.font_family
            color: root.text_color
            size_hint_y: 0.12
            text_size: self.width, None
            halign: 'center'
            valign: 'middle'

        TextInput:
            id: task_input
            size_hint_y: 0.18
            hint_text: 'e.g., Call Daughter...'
            hint_text_color: 0.6, 0.6, 0.6, 1
            font_name: root.font_family
            multiline: False
            background_normal: ''
            background_active: ''
            background_color: root.input_background
            foreground_color: root.input_text_color
            font_size: root.label_font_size
            padding: [dp(10), dp(8)]
            canvas.before:
                Color:
                    rgba: root.input_border_color
                Line:
                    width: dp(1.5)
                    rounded_rectangle: [self.x, self.y, self.width, self.height, dp(6)]

        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.18
            spacing: dp(10)
            
            Label:
                text: 'TIME:'
                font_size: root.label_font_size
                font_name: root.font_family
                color: root.text_color
                size_hint_x: 0.25
                text_size: self.width, None
                halign: 'center'
                valign: 'middle'

            TextInput:
                id: time_input
                size_hint_x: 0.15
                hint_text: '06:00'
                hint_text_color: 0.6, 0.6, 0.6, 1
                text: ''
                font_name: root.font_family
                multiline: False
                background_normal: ''
                background_active: ''
                background_color: root.input_background
                foreground_color: root.input_text_color
                padding: [dp(8), dp(8)]
                font_size: root.label_font_size
                canvas.before:
                    Color:
                        rgba: root.input_border_color
                    Line:
                        width: dp(1.2)
                        rounded_rectangle: [self.x, self.y, self.width, self.height, dp(6)]

            Spinner:
                id: am_pm_spinner
                size_hint_x: 0.1
                text: 'AM'
                values: ['AM', 'PM']
                font_name: root.font_family
                background_normal: ''
                background_color: root.input_background
                color: root.input_text_color
                font_size: root.label_font_size
                canvas.before:
                    Color:
                        rgba: root.input_border_color
                    Line:
                        width: dp(1.2)
                        rounded_rectangle: [self.x, self.y, self.width, self.height, dp(6)]

            Widget:
                size_hint_x: 0.3

        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.2
            spacing: dp(15)
            padding: [dp(20), dp(5), dp(20), 0]

            Button:
                text: 'Cancel'
                font_size: root.button_font_size
                font_name: root.font_family
                background_normal: ''
                background_color: 0, 0, 0, 0
                color: root.text_color
                on_press: root.dismiss()
                canvas.before:
                    Color:
                        rgba: root.cancel_button_color
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(8),]

            Button:
                text: 'Save Task'
                font_size: root.button_font_size
                font_name: root.font_family
                background_normal: ''
                background_color: 0, 0, 0, 0
                color: root.text_color
                on_press: root.save_task()
                canvas.before:
                    Color:
                        rgba: root.save_button_color
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(8),]

<ConfirmationPopup>:
    title: root.popup_title

    canvas.before:
        Color:
            rgba: 0.5, 0.5, 0.55, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(20),]
        Color:
            rgba: 0.95, 0.93, 0.85, 1
        Line:
            width: dp(0.5)
            rounded_rectangle: [self.x, self.y, self.width, self.height, dp(20)]

    BoxLayout:
        orientation: 'vertical'
        padding: root.container_padding
        spacing: root.container_spacing

        Label:
            text: root.confirmation_text
            font_size: root.label_font_size
            font_name: root.font_family
            color: root.text_color
            size_hint_y: 0.6
            text_size: self.width, None
            halign: 'center'
            valign: 'middle'

        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.3
            spacing: dp(15)
            padding: [dp(30), 0]

            Button:
                text: 'OK'
                font_size: root.button_font_size
                font_name: root.font_family
                background_normal: ''
                background_color: 0, 0, 0, 0
                color: root.text_color
                on_press: root.dismiss()
                canvas.before:
                    Color:
                        rgba: root.save_button_color
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(8),]

<ListeningPopup>:
    title: 'Listening...'

    canvas.before:
        Color:
            rgba: 0.5, 0.5, 0.55, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(20),]
        Color:
            rgba: 0.95, 0.93, 0.85, 1
        Line:
            width: dp(0.5)
            rounded_rectangle: [self.x, self.y, self.width, self.height, dp(20)]

    BoxLayout:
        orientation: 'vertical'
        padding: root.container_padding
        spacing: root.container_spacing

        Label:
            text: 'Speak your command now'
            font_size: root.label_font_size
            font_name: root.font_family
            color: root.text_color
            size_hint_y: 0.3
            text_size: self.width, None
            halign: 'center'
            valign: 'middle'

        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.4
            padding: [dp(20), 0]

            Image:
                source: 'assets/icons/listen.png'
                size_hint_x: 0.4
                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                fit_mode: 'contain'

        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.2
            spacing: dp(15)
            padding: [dp(30), 0]

            Button:
                text: 'Cancel'
                font_size: root.button_font_size
                font_name: root.font_family
                background_normal: ''
                background_color: 0, 0, 0, 0
                color: root.text_color
                on_press: root.dismiss()
                canvas.before:
                    Color:
                        rgba: root.cancel_button_color
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(8),]

# Apply the same pattern to other popups - move canvas.before from BasePopup to each concrete popup
<SettingsConfirmationPopup>:
    title: 'Settings Saved'

    canvas.before:
        Color:
            rgba: 0.5, 0.5, 0.55, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(20),]
        Color:
            rgba: 0.95, 0.93, 0.85, 1
        Line:
            width: dp(0.5)
            rounded_rectangle: [self.x, self.y, self.width, self.height, dp(20)]

    BoxLayout:
        orientation: 'vertical'
        padding: root.container_padding
        spacing: root.container_spacing
        
        Label:
            text: getattr(root, 'confirmation_text', 'Settings saved')
            font_size: root.label_font_size
            font_name: root.font_family
            color: root.text_color
            size_hint_y: 0.6
            text_size: self.width, None
            halign: 'center'
            valign: 'middle'
            
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.3
            spacing: dp(15)
            padding: [dp(30), 0]
            
            Button:
                text: 'OK'
                font_size: root.button_font_size
                font_name: root.font_family
                background_normal: ''
                background_color: 0, 0, 0, 0
                color: root.text_color
                on_release: root.dismiss()
                canvas.before:
                    Color:
                        rgba: root.save_button_color
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(8),]

<DefaultSettingsPopup>:
    title: 'Default Settings'

    canvas.before:
        Color:
            rgba: 0.5, 0.5, 0.55, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(20),]
        Color:
            rgba: 0.95, 0.93, 0.85, 1
        Line:
            width: dp(0.5)
            rounded_rectangle: [self.x, self.y, self.width, self.height, dp(20)]

    BoxLayout:
        orientation: 'vertical'
        padding: root.container_padding
        spacing: root.container_spacing
        
        Label:
            text: getattr(root, 'confirmation_text', 'Default settings restored!')
            font_size: root.label_font_size
            font_name: root.font_family
            color: root.text_color
            size_hint_y: 0.6
            text_size: self.width, None
            halign: 'center'
            valign: 'middle'
            
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.3
            spacing: dp(15)
            padding: [dp(30), 0]
            
            Button:
                text: 'OK'
                font_size: root.button_font_size
                font_name: root.font_family
                background_normal: ''
                background_color: 0, 0, 0, 0
                color: root.text_color
                on_release: root.dismiss()
                canvas.before:
                    Color:
                        rgba: root.save_button_color
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(8),]

<AlarmPopup>:
    title: 'REMINDER !!!'
    auto_dismiss: False
    
    canvas.before:
        Color:
            rgba: 0.15, 0.15, 0.2, 1
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(20),]
        Color:
            rgba: 0.8, 0.2, 0.2, 1
        Line:
            width: dp(2)
            rounded_rectangle: [self.x, self.y, self.width, self.height, dp(20)]

    BoxLayout:
        orientation: 'vertical'
        padding: root.container_padding
        spacing: root.container_spacing

        Label:
            text: 'Task Reminder'
            font_size: root.label_font_size
            font_name: root.font_family
            bold: True
            color: 0.9, 0.3, 0.3, 1
            size_hint_y: 0.3
            text_size: self.width, None
            halign: 'center'
            valign: 'middle'

        Label:
            text: (root.task.title + '\n\nTime: ' + root.task.due_time) if root.task else ''
            font_size: root.label_font_size
            font_name: root.font_family
            color: root.text_color
            size_hint_y: 0.5
            text_size: self.width, None
            halign: 'center'
            valign: 'middle'

        Button:
            text: 'Dismiss'
            font_size: root.button_font_size
            font_name: root.font_family
            size_hint_y: 0.2      
            height: dp(40)       
            background_normal: ''
            background_color: 0, 0, 0, 0
            color: root.text_color
            on_press: root.dismiss_alarm()
            canvas.before:
                Color:
                    rgba: root.save_button_color
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [dp(8),]