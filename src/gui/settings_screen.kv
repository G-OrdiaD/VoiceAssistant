#:kivy 2.3.1
#:import dp kivy.metrics.dp


# Rounded chip used for option selections (Font/Voice)
<Chip@Button>:
    size_hint_y: None
    height: dp(42)
    padding: [dp(14), 0]
    background_normal: ''
    background_color: 0,0,0,0
    color: 0,0,0,1
    font_size: dp(16)
    font_name: app.font_family
    canvas.before:
        Color:
            rgba: (0.86, 0.87, 0.9, 1) if self.state=='normal' else (0.72, 0.75, 0.92, 1)
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(10),]


<SettingsScreen>:
    canvas.before:
        Color:
            rgba: 1,1,1,1
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: 'vertical'
        padding: [dp(20), dp(15), dp(20), dp(15)]
        spacing: dp(18)

        # Top bar (HOME chip)
        BoxLayout:
            size_hint_y: None
            height: dp(52)
            padding: [0, 0, 0, 0]

            Button:
                text: 'HOME'
                font_size: dp(20)
                font_name: app.font_family
                size_hint_x: 0.2
                size_hint_y: None
                height: dp(35)
                on_release: root.go_back()
                color: 1, 1, 1, 1
                background_normal: ''
                background_color: 0, 0, 0, 0
                canvas.before:
                    Color:
                        rgba: 0.36, 0.52, 0.96, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(8),]
            
            Widget:
                size_hint_x: 1

        # Big title
        Label:
            text: 'SETTINGS'
            font_size: dp(32)
            font_name: app.font_family  
            bold: True
            color: (0.6, 0.4, 0.2, 1) if not root.high_contrast else (0, 0, 0, 1)
            size_hint_y: None
            height: dp(40)
            text_size: self.width, None
            halign: 'center'
            valign: 'middle'

        # Content
        ScrollView:
            do_scroll_x: False
            bar_width: dp(6)
            bar_color: 0.5, 0.5, 0.5, 0.7
            BoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
                spacing: dp(24)
                padding: [dp(10), dp(10)]

                # ---- Font Type (chips) ----
                Label:
                    text: f"Font Type: {root.font_family}"
                    font_size: dp(20)
                    font_name: app.font_family  
                    color: 0,0,0,1
                    size_hint_y: None
                    height: dp(30)
                    text_size: self.size
                    halign: 'left'

                BoxLayout:
                    size_hint_y: None
                    height: dp(46)
                    spacing: dp(10)
                    Chip:
                        text: "Arial"
                        font_name: "Arial"  # PREVIEW - shows actual font
                        bold: False
                        on_release: root.on_font_family_change(self, "Arial")
                    Chip:
                        text: "CrimsonPro"  
                        font_name: "CrimsonPro"
                        italic: True
                        on_release: root.on_font_family_change(self, "CrimsonPro")
                    Chip:
                        text: "Rubik"
                        font_name: "Rubik"
                        bold: True
                        on_release: root.on_font_family_change(self, "Rubik")
                    Chip:
                        text: "Balsamiq"
                        font_name: "BalsamiqSans"
                        on_release: root.on_font_family_change(self, "BalsamiqSans")

                # ---- Font Size with live value ----
                BoxLayout:
                    orientation: 'horizontal'
                    size_hint_y: None
                    height: dp(30)
                    Label:
                        text: "Font Size:"
                        font_size: dp(20)
                        font_name: app.font_family  
                        color: 0,0,0,1
                        size_hint_x: 0.6
                        text_size: self.size
                        halign: 'left'
                        valign: 'middle'
                    Label:
                        id: font_size_label
                        text: f"{int(root.font_size)} Px"
                        font_size: dp(18)
                        font_name: app.font_family 
                        color: 0.3,0.3,0.3,1
                        size_hint_x: 0.4
                        text_size: self.size
                        halign: 'right'
                        valign: 'middle'
                Slider:
                    id: font_size_slider
                    min: 14
                    max: 32
                    step: 1
                    value: root.font_size
                    size_hint_y: None
                    height: dp(36)
                    on_value: root.on_font_size_change(self, self.value)

                # ---- Voice Type (chips) ----
                Label:
                    text: f"Voice Type: {root.get_voice_labels()[root.current_voice] if 0 <= root.current_voice < len(root.get_voice_labels()) else 'Default'}"
                    font_size: dp(22)
                    font_name: app.font_family
                    color: 0,0,0,1
                    size_hint_y: None
                    height: dp(30)
                    text_size: self.size
                    halign: 'left'
                
                BoxLayout:
                    size_hint_y: None
                    height: dp(46)
                    spacing: dp(10)
                    Chip:
                        text: root.get_voice_labels()[0] if len(root.get_voice_labels()) > 0 else "Eddy"
                        on_release: root.on_voice_change(self, 0)
                    Chip:
                        text: root.get_voice_labels()[1] if len(root.get_voice_labels()) > 1 else "Karen" 
                        on_release: root.on_voice_change(self, 1)
                    Chip:
                        text: root.get_voice_labels()[2] if len(root.get_voice_labels()) > 2 else "Tessa"
                        on_release: root.on_voice_change(self, 2)
                    Chip:
                        text: root.get_voice_labels()[3] if len(root.get_voice_labels()) > 3 else "GrandPa"
                        on_release: root.on_voice_change(self, 3)

                # ---- Voice Speed (slider: Slow/Normal/Fast) ----
                Label:
                    text: f"Voice Speed: {root.voice_speed}"
                    font_size: dp(22)
                    font_name: app.font_family 
                    color: 0,0,0,1
                    size_hint_y: None
                    height: dp(30)
                    text_size: self.size
                    halign: 'left'
                
                Slider:
                    id: voice_speed_slider
                    min: 0
                    max: 2
                    step: 1
                    value: 1 if root.voice_speed=='Normal' else (0 if root.voice_speed=='Slow' else 2)
                    size_hint_y: None
                    height: dp(36)
                    on_value: root.on_voice_speed_slider(self, int(self.value))

                # ---- High-contrast (toggle button) ----
                BoxLayout:
                    orientation: 'horizontal'
                    size_hint_y: None
                    height: dp(50)
                    spacing: dp(10)
                    
                    Label:
                        text: "High Contrast Mode:"
                        font_size: dp(22)
                        font_name: app.font_family  
                        color: 0,0,0,1
                        size_hint_x: 0.7
                        text_size: self.size
                        halign: 'left'
                        valign: 'middle'
                    
                    Button:
                        id: contrast_btn
                        text: 'ON' if root.high_contrast else 'OFF'
                        font_size: dp(18)
                        font_name: app.font_family
                        background_normal: ''
                        background_color: 0,0,0,0
                        color: 1,1,1,1
                        size_hint_x: 0.3
                        on_release: root.on_contrast_button(self)
                        canvas.before:
                            Color:
                                rgba: (0.8, 0.2, 0.2, 1) if root.high_contrast else (0.2, 0.8, 0.2, 1)
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [dp(8),]

        # Footer actions
        Widget:
            size_hint_y: None
            height: dp(10)

        # Footer actions 
        BoxLayout:
            size_hint_y: None
            height: dp(56)
            spacing: dp(16)
            padding: [dp(10), 0]

            # Reset to Default 
            Button:
                text: 'Reset to Default'
                font_size: dp(18)
                font_name: app.font_family  
                color: 1,1,1,1
                background_normal: ''
                background_color: 0,0,0,0
                on_release: root.reset_to_default()
                canvas.before:
                    Color:
                        rgba: 0.36, 0.52, 0.96, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(8),]

            # Save Settings 
            Button:
                text: 'Save Settings'
                font_size: dp(18)
                font_name: app.font_family  
                color: 1,1,1,1
                background_normal: ''
                background_color: 0,0,0,0
                on_release: root.save_settings()
                canvas.before:
                    Color:
                        rgba: 0.36, 0.52, 0.96, 1
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(8),]